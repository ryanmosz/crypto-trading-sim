<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Multiplayer Game Creation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 5px;
        }
        button:hover {
            background: #00cc6a;
        }
        .log {
            background: #2a2a2a;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #00ff88;
        }
        .error {
            color: #ff4444;
        }
        .game-code {
            font-size: 48px;
            font-weight: bold;
            color: #00ff88;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
            letter-spacing: 10px;
        }
    </style>
</head>
<body>
    <h1>Test Multiplayer Game Creation</h1>
    
    <button id="testAuth">1. Test Authentication</button>
    <button id="createGame" disabled>2. Create Multiplayer Game</button>
    
    <div id="gameCode" class="game-code" style="display: none;"></div>
    
    <div id="log" class="log"></div>

    <!-- Load dependencies with cache busting -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Force fresh load of all modules
        const timestamp = Date.now();
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            log.innerHTML += `[${time}] <span class="${className}">${message}</span>\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        addLog('Loading fresh modules with timestamp: ' + timestamp);
    </script>
    
    <!-- Load config and auth with cache busting -->
    <script type="module">
        const timestamp = Date.now();
        
        // Import modules with cache busting
        const configModule = await import(`./config.js?v=${timestamp}`);
        const authModule = await import(`./auth.js?v=${timestamp}`);
        const apiModule = await import(`./services/nowGameApi.js?v=${timestamp}`);
        
        const { auth } = authModule;
        const { createNowGame } = apiModule;
        
        window.addLog('Modules loaded successfully', 'success');
        
        // Test authentication
        document.getElementById('testAuth').addEventListener('click', async () => {
            try {
                window.addLog('Testing authentication...');
                const { data: { session } } = await auth.supabase.auth.getSession();
                
                if (session) {
                    window.addLog(`Authenticated as: ${session.user.email}`, 'success');
                    window.addLog(`User ID: ${session.user.id}`, 'success');
                    document.getElementById('createGame').disabled = false;
                } else {
                    window.addLog('No active session. Please log in first.', 'error');
                    window.addLog('Redirecting to main app...');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                }
            } catch (error) {
                window.addLog(`Auth error: ${error.message}`, 'error');
            }
        });
        
        // Create multiplayer game
        document.getElementById('createGame').addEventListener('click', async () => {
            try {
                window.addLog('Creating multiplayer game...');
                
                const testAllocations = {
                    BTC: 4,
                    ETH: 3,
                    BNB: 1,
                    SOL: 1,
                    XRP: 1
                };
                
                window.addLog('Allocations: ' + JSON.stringify(testAllocations));
                window.addLog('Duration: 30 days');
                
                const result = await createNowGame({
                    duration: 30,
                    allocations: testAllocations
                });
                
                window.addLog('Game created successfully!', 'success');
                window.addLog('Game ID: ' + result.game_id, 'success');
                window.addLog('Game Code: ' + result.game_code, 'success');
                window.addLog('Starting prices: ' + JSON.stringify(result.starting_prices));
                
                // Display game code prominently
                document.getElementById('gameCode').textContent = result.game_code;
                document.getElementById('gameCode').style.display = 'block';
                
            } catch (error) {
                window.addLog(`Error creating game: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        });
    </script>
</body>
</html> 